<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" class="logo" width="120"/>

# Status Review \& Action Plan for Persistent, Non-Guest Profiles in “Samay”

## Overview

Development stalled at the **session-persistence layer**. SeleniumBase UC Mode is still a **temporary guest profile**, so cookies, localStorage, and Google/Claude/Perplexity tokens vanish each run. The assistant therefore fails to reuse prior logins and you must repeat MFA/OTP loops every startup.

Below is a precise breakdown of (1) why we are stuck, (2) viable fixes to attach to an existing Chrome profile _or_ create a long-lived “Samay” profile, and (3) how to integrate these fixes into the multi-agent orchestration you paused.

## Why the Browser Always Opens as “Guest”

### 1. UC Mode’s Hard-Wired Defaults

- UC Mode spawns Chrome with `--incognito` + an **ephemeral** user-data directory when no `user_data_dir` is supplied.  [^1][^2]
- If you _do_ supply `user_data_dir` but point at a directory **not originally generated by UC Mode**, UC forces a safe-mode guest profile to avoid mixing fingerprints.  [^3][^4]
- UC also auto-appends `\Default` to any path, ignoring `--profile-directory` by design.[^2]


### 2. Chrome 136+ Security Change

- Starting May 2025, Chrome blocks `--remote-debugging-port` and `--user-data-dir` when they target the default profile; a **non-default path is now mandatory**. UC silently falls back to a guest profile if the policy is violated.[^5]


### 3. Profile-in-Use \& Lock Files

- If any normal Chrome window already owns the requested directory, ChromeDriver must start in guest to avoid “profile in use” errors.[^6][^3]


## Two Working Paths to Persistence

### Path A: Attach to an Existing, Signed-In Profile

1. **Launch normal Chrome manually** (or via script) using:

```
chrome.exe ^
  --remote-debugging-port=9222 ^
  --user-data-dir=C:\SamayProfiles\Primary
```

This opens Chrome with your usual tokens in `C:\SamayProfiles\Primary\Default`.
2. **Connect Selenium/UC to that running instance**:

```python
from selenium import webdriver
from selenium.webdriver.chrome.options import Options

opts = Options()
opts.add_experimental_option("debuggerAddress", "127.0.0.1:9222")
driver = webdriver.Chrome(options=opts)
```

    - No new window appears; Selenium hijacks the existing tab set.  [^7][^8]
    - All cookies, MFA tokens, and logged-in state persist across restarts because Chrome never closes.
3. **Automation Caveats**
    - You must guarantee the debugger port is listening before your agents start; a small Powershell/bootstrap script solves this.
    - **Anti-bot impact** is minimal because the browser fingerprint exactly matches a human session.

### Path B: Auto-Create \& Reuse a Dedicated “Samay” Profile

1. **First-Run Script (one-time)**

```python
from seleniumbase import Driver

SAMAY_DIR = r"C:\SamayProfiles\Claude"  # choose a fresh, empty folder
with Driver(uc=True, user_data_dir=SAMAY_DIR, headed=True) as sb:
    sb.open("https://claude.ai")
    # perform Google-SSO or OTP capture flow here
# On exit, UC leaves a fully populated profile at SAMAY_DIR\Default
```

2. **Subsequent Runs** – _Always_ point to the same directory:

```python
from seleniumbase import Driver
driver = Driver(uc=True,
                user_data_dir=r"C:\SamayProfiles\Claude",
                headed=False)  # now can go headless if desired
driver.open("https://claude.ai")
assert "Dashboard" in driver.title
```

    - Because the folder was created by UC, the stealth patches remain valid and Chrome opens as a regular profile, not guest.  [^2][^4]
    - Never open that same folder simultaneously in regular Chrome; instead clone it if manual inspection is needed.[^9]
3. **Lock Handling**
    - Before each run delete stale `SingletonLock`/`SingletonSocket` files if a crash occurred; this prevents “profile in use” fallback.[^6]

## Implementing OTP/Google-SSO Auto-Login

Your alternative idea—automatically fetching the OTP from Gmail and entering it—is feasible _after_ persistent profiles are working:

1. **IMAP or Gmail API** to poll the inbox for the latest “Your Claude code is 123-456” message.
2. **DOM-Query Poll**: wait for the six input boxes, paste digits.
3. **Cookie Export**: once authenticated, dump cookies to disk as a secondary fallback.[^10]

Because the profile now persists, OTP flow should trigger rarely (only when service tokens truly expire).

## Integrating Other Agents (Gemini \& Perplexity)

1. **One Folder per Service**

```
C:\SamayProfiles\
    ├─ Claude\
    ├─ Gemini\
    └─ Perplexity\
```

Keeps cookies isolated; avoids cross-origin token leaks.
2. **Orchestration Layer**
    - Spin up three Drivers **sequentially** at startup, each with its path and optional proxy assignment.  [^11]
    - Maintain a lightweight health-check: open a zero-cost endpoint (e.g., `/settings`) and verify presence of a user avatar every N minutes; if redirected to `/login`, trigger OTP workflow.
3. **Thread Safety**
    - Do **not** point two concurrent Driver objects at the same folder; UC throws `RuntimeError: You cannot reuse the ChromeOptions object`. Launch browsers serially or clone the profile.[^12]

## Summary of Immediate Steps

| Step | Action | Command / Code Snippet | Result |
| :-- | :-- | :-- | :-- |
| 1 | Choose Path A or Path B | See above | Persistent profile, no guest |
| 2 | Kill residual lock files before driver start | `del /q "C:\SamayProfiles\*\*Singleton*"` | Prevent fallback |
| 3 | Bring up assistant with per-service profiles | `Driver(uc=True, user_data_dir=…)` | Parallel, logged-in sessions |
| 4 | Implement watchdog check | `driver.find_element("#avatar")` | Auto-relogin if needed |
| 5 | (Optional) OTP automation | Gmail API + DOM injection | Touch-free renewals |

By following either attachment (Path A) or dedicated-profile (Path B) workflow, “Samay” will finally bypass the guest-profile trap, retain sessions across reboots, and free you to resume multi-agent features without repeated manual logins.

<div style="text-align: center">⁂</div>

[^1]: https://seleniumbase.io/help_docs/uc_mode/

[^2]: https://stackoverflow.com/questions/77390094/how-to-use-user-profile-with-seleniumbase

[^3]: https://github.com/seleniumbase/SeleniumBase/discussions/3049

[^4]: https://github.com/seleniumbase/SeleniumBase/discussions/2775

[^5]: https://stackoverflow.com/questions/79634525/unable-to-connect-to-existing-chrome-browser-with-selenium-chrome-driver-after-l/79636351

[^6]: https://stackoverflow.com/questions/64387126/python-selenium-chrome-user-data-directory-is-already-in-use/70443995

[^7]: https://www.tzhwang.com/2021/12/30/reusing-existing-browser-session-in-selenium/

[^8]: https://cosmocode.io/how-to-connect-selenium-to-an-existing-browser-that-was-opened-manually/

[^9]: https://stackoverflow.com/questions/50635087/how-to-open-a-chrome-profile-through-user-data-dir-argument-of-selenium

[^10]: https://github.com/seleniumbase/SeleniumBase/issues/2629

[^11]: https://stackoverflow.com/questions/78561940/proxy-param-not-taken-into-account-by-seleniumbase-in-uc-mode

[^12]: https://github.com/seleniumbase/SeleniumBase/issues/3027

[^13]: https://github.com/ultrafunkamsterdam/undetected-chromedriver/discussions/1101

[^14]: https://stackoverflow.com/questions/31062789/how-to-load-default-profile-in-chrome-using-python-selenium-webdriver

[^15]: https://www.zenrows.com/blog/navigator-webdriver

[^16]: https://superuser.com/questions/1130368/chrome-user-data-dir-not-working-properly

[^17]: https://github.com/SeleniumHQ/selenium/issues/15729

[^18]: https://stackoverflow.com/questions/79647808/cannot-use-local-user-data-for-chrome-while-running-selenium

[^19]: https://stackoverflow.com/questions/53039551/selenium-webdriver-modifying-navigator-webdriver-flag-to-prevent-selenium-detec

[^20]: https://github.com/seleniumbase/SeleniumBase/issues/2336

[^21]: https://rebrowser.net/blog/undetected-chromedriver-the-ultimate-guide-to-bypassing-bot-detection

[^22]: https://www.reddit.com/r/learnpython/comments/1b5nr7j/opening_chrome_with_a_specific_profile_using/

[^23]: https://github.com/SeleniumHQ/selenium/issues/15327

[^24]: https://www.zenrows.com/blog/selenium-avoid-bot-detection

[^25]: https://stackoverflow.com/questions/76444662/how-can-i-use-undetected-chromedriver-to-init-function

[^26]: https://stackoverflow.com/questions/74981809/im-using-selenium-undetected-chromedriver-and-i-cant-open-multiple-profiles-at

[^27]: https://developer.chrome.com/docs/chromedriver/capabilities

[^28]: https://www.reddit.com/r/learnpython/comments/1heq4sf/selenium_is_not_working_when_i_ask_it_to_open/

[^29]: https://github.com/seleniumbase/SeleniumBase/issues/2404

[^30]: https://www.zenrows.com/blog/undetected-chromedriver

[^31]: https://support.bark.us/hc/en-us/articles/360050415971-Disable-Guest-Mode-Incognito-Mode-Secure-DNS-on-Chrome-Windows

[^32]: https://pypi.org/project/undetected-chromedriver/

[^33]: https://stackoverflow.com/questions/78195958/exit-cookies-pop-up-on-ups-website-using-python-with-selenium-and-seleniumbase

[^34]: https://stackoverflow.com/questions/19026295/run-chrome-browser-in-inconginto-mode-in-selenium/19176191

[^35]: https://stackoverflow.com/questions/74149207/how-to-enable-incognito-mode-in-chrome-when-using-selenium/74149253

[^36]: https://www.zenrows.com/blog/selenium-cloudflare-bypass

[^37]: https://github.com/ultrafunkamsterdam/undetected-chromedriver/issues/557

[^38]: https://seleniumbase.io

[^39]: https://issues.chromium.org/issues/42320361

[^40]: https://stackoverflow.com/questions/71617458/selenium-chrome-webdriver-in-incognito-mode

[^41]: https://seleniumbase.io/help_docs/customizing_test_runs/

[^42]: https://developer.chrome.com/docs/devtools/remote-debugging/local-server

[^43]: https://stackoverflow.com/questions/47861813/how-can-i-reconnect-to-the-browser-opened-by-webdriver-with-selenium

[^44]: https://stackoverflow.com/questions/51563287/how-to-make-chrome-always-launch-with-remote-debugging-port-flag

[^45]: https://abodeqa.com/how-to-connect-selenium-to-existing-chrome-browser/

[^46]: https://groups.google.com/g/google-chrome-developer-tools/c/PAeHj2gBBCU

[^47]: https://posts.specterops.io/hands-in-the-cookie-jar-dumping-cookies-with-chromiums-remote-debugger-port-34c4f468844e

[^48]: https://www.reddit.com/r/learnpython/comments/p0lkyi/how_to_control_my_existing_chrome_window_with/

[^49]: https://www.selenium.dev/documentation/webdriver/browsers/chrome/

[^50]: https://developer.chrome.com/docs/devtools/remote-debugging

[^51]: https://www.linkedin.com/pulse/running-selenium-tests-already-opened-chrome-browser-using-kabir

[^52]: https://developers.google.com/cast/docs/debugging/remote_debugger

[^53]: https://www.youtube.com/watch?v=LBpa6UIDToY

[^54]: https://www.browserstack.com/guide/run-selenium-tests-using-selenium-chromedriver

[^55]: https://chromedevtools.github.io/devtools-protocol/

[^56]: https://qxf2.com/blog/reuse-existing-selenium-browser-session/

